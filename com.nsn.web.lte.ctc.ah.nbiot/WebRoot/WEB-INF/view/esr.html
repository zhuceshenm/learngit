<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title></title><!--GIS CSS样式开始--><link rel="stylesheet" href="/static/gis/leaflet/leaflet.css" /><link rel="stylesheet" href="/static/gis/leaflet/plugins.css" /><style>html {	height: 100%}body {	height: 100%;	margin: 0;	padding: 0}#gis {	position: absolute;	top: 0px;	left: 0px;	right: 0px;	bottom: 0px;	height: 100% !important;	width: 100% !important;}</style></head><body>	<div id="gis"></div></body><!--GIS类库的加载 开始--><script type="text/javascript" src="static/js/charts/jquery-1.8.2.js"></script><!-- <script src='../../../dwr/engine.js'></script> --><!-- <script src='../../../dwr/util.js'></script> --><!-- <script src='../../../dwr/interface/nbiotService.js'></script> --><script type="text/javascript" src="/static/gis/leaflet/leaflet.js"></script><script type="text/javascript" src="/static/gis/leaflet/plugins.min.js"></script><script type="text/javascript" src="static/js/cfg.js"></script><script type="text/javascript" src="static/js/volte.js"></script><!--GIS类库的加载 结束--><script type="text/javascript"> function getDate(minute_add){	 var sdate = $(window.parent.document.getElementById("startDatetimepicker_h")).val();	 if(minute_add==null||minute_add=='undefined'){		 return sdate;	 }else{		 minute_add = minute_add<10?"0"+minute_add:minute_add;		 return sdate.substring(0,14)+minute_add+":00";	 } }  function GetQueryString(name) {    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");    var r = window.location.search.substr(1).match(reg);    if(r && r!='+uid+')return  unescape(r[2]); return ''; }  function resize(){    $("#gis").width($(window).width());    $("#gis").height($(window).height()-42); } var volte,interval,sdate_time=0;  $(function() {    resize();    $(window).resize(function(){      resize();    });    var type = GetQueryString("type");        var kpis = ['用户数'];    if(type==3){    		kpis = ['用户数','解锁次数'];    }    if(type==4){		kpis = ['用户数'];	}    if(type==5){		kpis = ['业务发起数','用户数','ATTACH成功率','pdn成功率'];	}    volte = L.volte('gis',kpis);    var defaultKpi = type==3?'解锁次数':'用户数';    if(type==4){    	 defaultKpi = '用户数';    }    if(type==5){   	 defaultKpi = '业务发起数';    }    volte.setKpi(defaultKpi);    var sdate = $(window.parent.document.getElementsByClassName("J-SDATE")).val();    var isknow = $(window.parent.document.getElementsByClassName("J-ISKNOW")).val();    var area = $(window.parent.document.getElementsByClassName("J-AREA")).val();    var category = $(window.parent.document.getElementsByClassName("J-CATEGORY")).val();    var scene = $(window.parent.document.getElementsByClassName("J-SCENE")).val();    var custom = $(window.parent.document.getElementsByClassName("J-CUSTOM")).val();    var apn = $(window.parent.document.getElementsByClassName("J-APN")).val();        if(type==1||type=='1'){	    	interval = setInterval(function(){	    		sdate_time+=5;	    		if(sdate_time==60){	    			sdate_time = 0;	    		}	    		nbiotService.getGisData(type,getDate(sdate_time),isknow, area,category, scene, custom, apn,function(data) {	    			if(sdate_time>=55){	        			sdate_time = 0;	        		}	        		var gisData = [];	        		if(data && data.length>0){	            		$.each(data,function(i){	            			gisData[i] = {'小区号':data[i].eci,"用户数":data[i].users,"LONGITUDE":data[i].LONGITUDE,"LATITUDE":data[i].LATITUDE};	            		});	                volte.loadCells(gisData);	            	}	        	});	    	},8000)    }    //安吉星分析    else if(type==4||type=='4'){	    	if(interval){	    		window.clearInterval(interval);	    		sdate_time = 0;	    	}	    	nbiotService.getGisData(type,getDate(sdate_time),isknow, area,category, scene, custom, apn,function(data) {	    		var gisData = [];	    		if(data && data.length>0){	        		$.each(data,function(i){	        			gisData[i] = {'小区名':data[i].SITE_NAME,'小区号':data[i].ECI,"用户数":data[i].USER_COUNTS,"LONGITUDE":data[i].LONGITUDE,"LATITUDE":data[i].LATITUDE};	        		});	            volte.loadCells(gisData);	        	}	    	});	}	//松江燃气    else if(type==5||type=='5'){	    	if(interval){	    		window.clearInterval(interval);	    		sdate_time = 0;	    	}	    	//nbiotService.getGisData(type,getDate(sdate_time),isknow, area,category, scene, custom, apn,	    	$.ajax({				type: "POST",				url:"/nbiot/gas/getGisData",				data:{					"v_sdate":sdate				},				dataType:'json',				success:function(data) {		    		var gisData = [];		    		if(data && data.length>0){		        		$.each(data,function(i){		        			gisData[i] = {'小区名':data[i].wirelessname,'小区号':data[i].eci,"业务发起数":data[i].servince_count,"用户数":data[i].users,'ATTACH成功率':data[i].attach_rate,'pdn成功率':data[i].pdn_rate,"LONGITUDE":data[i].longitude,"LATITUDE":data[i].latitude};		        		});		            	volte.loadCells(gisData);		        	}				}	    	});	}    else{	    	if(interval){	    		window.clearInterval(interval);	    		sdate_time = 0;	    	}	    	nbiotService.getGisData(type,getDate(sdate_time),isknow, area,category, scene, custom, apn,function(data) {	    		var gisData = [];	    		if(data && data.length>0){	        		$.each(data,function(i){	        			if(type==3){	        				gisData[i] = {'小区名':data[i].SITE_NAME,'小区号':data[i].CI,"解锁次数":data[i].SMS_REQ_CNT,"用户数":data[i].USER_COUNTS,"LONGITUDE":data[i].LONGITUDE,"LATITUDE":data[i].LATITUDE};	        			}else{	        				gisData[i] = {'小区名':data[i].SITE_NAME,'小区号':data[i].ECI,"用户数":data[i].COUNTS,"LONGITUDE":data[i].LONGITUDE,"LATITUDE":data[i].LATITUDE};	        			}	        		});	           	volte.loadCells(gisData);	        	}	    	});    }  });  function centerAndZoom(lon,lat){// 	  volte.map.panTo(new L.LatLng(lat,lon));	  volte.map.panTo(new L.LatLng(lat,lon));	  volte.map.setZoom(15);		var icon = L.icon({	      iconUrl: 'img/leaflet/location.png',	      iconSize: [40, 40],	      iconAnchor: [6, 6]	    });		L.marker([lat,lon], {icon: icon}).addTo(volte.map);  }</script></html>